function parseTeams(){$("#results").children(".bd").children("h4").each(function(){dGameDate=new Date($(this).text()),$(this).next(".pointspread").children("tbody").children("tr").each(function(){stGame={},$(this).children(".teams").children(".team").each(function(e){1==e?(stGame.sHomeTeam=$(this).children("a").text(),stGame.sHomeTeamURL=$(this).children("a").prop("href")):(stGame.sAwayTeam=$(this).children("a").text(),stGame.sAwayTeamURL=$(this).children("a").prop("href"))}),sGameDate=dGameDate.getFullYear()+"-"+convertMonthDay(dGameDate.getMonth()+1)+"-"+convertMonthDay(dGameDate.getDate()),arGameTimeFull=$(this).children(".teams").children("div").text().trim().split(" "),arGameTimeHoursMinutes=arGameTimeFull[0].split(":"),stGame.sGameDateTime=sGameDate.toString()+" "+("pm"==arGameTimeFull[1].toLowerCase()&&parseInt(arGameTimeHoursMinutes[0])<12?(parseInt(arGameTimeHoursMinutes[0])+12).toString()+":"+arGameTimeHoursMinutes[1]:arGameTimeHoursMinutes[0].toString()+":"+arGameTimeHoursMinutes[1]).toString(),sSpreadNode=$(this).children("td:nth-child(2)").children("div:nth-child(1)").children("span"),$(sSpreadNode).hasClass("bottom-line")?stGame.sSpreadFavor="home":stGame.sSpreadFavor="away",nSpread=$(sSpreadNode).text().replace("-",""),stGame.nSpread=parseFloat(nSpread).toString()==nSpread.toString()?parseFloat(nSpread):parseFloat(nSpread)+.5,stGame.sSpreadOriginal=stGame.nSpread,stGame.bShow=!0,stGame.nTiebreak="",stGame.dtLock=stGame.sGameDateTime,arGames.push(stGame)})})}function buildForm(e,a){for("string"!=typeof a&&(a="#availableGames"),itm=0;itm<e.length;itm++)addGame(e[itm],a);$(".loading").addClass("hide"),$("#games").removeClass("hide")}function addGame(e,a,t){"boolean"!=typeof t&&(t=!1);var s="";s=t?$("#defaultGame tr").clone(!0).prependTo(a+" tbody").removeClass("hide").data("game-id",e.nGameID):$("#defaultGame tr").clone(!0).appendTo(a+" tbody").removeClass("hide").data("game-id",e.nGameID),"boolean"==typeof e.bIsNew?($(s).find(".favorite,.underdog").autocomplete({source:"/?action=team.searchForTeam"}),$(s).find(".date").datepicker(),$(s).find(".time").ptTimeSelect(),$(s).find(".spread-favor").remove(),$(s).find(".move").closest("td").append('<select class="spread-favor"><option value="">Spread Favor</option><option value="home">Home</option><option value="away">Away</select>')):($(s).find(".move").removeClass("move").removeClass("glyphicon-sort").addClass("add").addClass("glyphicon-open"),"home"==e.sSpreadFavor?($(s).find(".favorite").val(e.sHomeTeam).addClass("home"),$(s).find(".underdog").val(e.sAwayTeam).addClass("away")):($(s).find(".favorite").val(e.sAwayTeam).addClass("away"),$(s).find(".underdog").val(e.sHomeTeam).addClass("home")),$(s).find(".game-date").val(e.sGameDateTime.split(" ")[0]),$(s).find(".game-time").val(e.sGameDateTime.split(" ")[1]?e.sGameDateTime.split(" ")[1].substr(0,5):""),$(s).find(".lock-date").val(e.dtLock.split(" ")[0]),$(s).find(".lock-time").val(e.dtLock.split(" ")[1]?e.dtLock.split(" ")[1].substr(0,5):""),$(s).find(".spread").val(e.nSpread),$(s).find(".spread-favor").val(e.sSpreadFavor),$(s).find(".tiebreak").val(e.nTiebreak))}function getGames(){$.get("/index.cfm?action=week.getGames&"+(new Date).getTime(),{nWeekID:$("#setWeek").data("id"),lstLeagueList:"ncaa,nfl"},function(e){"string"==typeof e&&e.length>0?($("#results").html(e),$("#start").removeClass("hide"),$(".loading").addClass("hide"),parseTeams(),buildForm(arGames),$("#source").removeClass("hide")):"object"==typeof e&&(e.length>0?buildForm(e,"#activeGames"):$(".loading").addClass("hide"))},"json")}function makeActive(){$(".save-games").removeClass("disabled")}function toDecimal(e){for(var a=0;a<e.length;a++)189==parseInt(e.charCodeAt(a))&&(e=e.replaceAt(a,".5"));return e}function fixTime(e){var a=[],t="",s="",i=e;return e.length>0&&e.indexOf(":")>0&&(a=e.split(":"),t=a[0],e.indexOf(" ")>0?(a=a[1].split(" "),s=a[0],"PM"==a[1]&&(t=parseInt(t)+12)):s=a[1],1==t.length&&(t="0"+t),i=t+":"+s+":00"),8!=i.length&&(i=""),i}function fact(e){return 0==e?1:e*fact(e-1)}docReady(function(){$(".container").on("click",".change-week",function(){window.location.href=$(this).closest("form").find("#sWeekURL").val()}),$("#activeGames tbody").sortable().on("sortstart",function(){$(".games").off("sortstart"),makeActive()}),$("#availableGames").on("click",".add",function(){$(this).closest("tr").appendTo("#activeGames tbody").find(".add").removeClass("add").removeClass("glyphicon-open").addClass("move").addClass("glyphicon-sort"),makeActive()}),$(".container").on("click",".edit",function(){window.location.href="/?action=week.addEdit&nWeekID="+$(this).closest("tr").data("id")}),$(".container").on("click",".add-week",function(){window.location.href="/?action=week.addEdit&bAdd=true"}),$(".week-actions").on("click",".delete",function(){confirm("CAUTION!!! Are you sure you want to delete this week? Deleting this week will delete ALL of the games, ALL of the picks and ALL of the standings. It will be irreversible and people will get mad if you are wrong. Are you sure you want to delete this week?")&&(window.location.href="/?action=week.delete&nWeekID="+$(this).closest("tr").data("id"))}),$("#addEditForm").on("click",".cancel",function(){confirm("Are you sure you want to cancel updating the week? All changes will be lost")&&(window.location.href="/?action=week.manage")}),$(".container").on("click",".game-actions .add-game",function(){var e={sHomeTeam:"",sHomeTeamURL:"",sAwayTeam:"",sAwayTeamURL:"",nSpread:"",sSpreadOriginal:"",sSpreadFavor:"",nTiebreak:"",sGameDateTime:"",bIsNew:!0};makeActive(),addGame(e,"#activeGames",!0)}),$(".container").on("change",".spread-favor",function(){"home"==$(this).val()?(sFavoriteClass="home",sUnderdogClass="away"):(sFavoriteClass="away",sUnderdogClass="home"),$(this).closest("tr").find(".favorite").removeClass("home").removeClass("away").addClass(sFavoriteClass),$(this).closest("tr").find(".underdog").removeClass("home").removeClass("away").addClass(sUnderdogClass)}),$(".container").on("click",".game .delete",function(){confirm("Are you sure you would like to remove the game between "+$(this).closest("tr").find(".favorite").val()+" and "+$(this).closest("tr").find(".underdog").val()+"?")&&($("#source").is(":visible")?$(this).closest("tr").appendTo("#availableGames").find(".move").removeClass("move").removeClass("glyphicon-sort").addClass("add").addClass("glyphicon-open"):$(this).closest("tr").remove()),makeActive()}),$(".swap-home").on("click",function(){$(this).closest("tr").find(".home").addClass("next-away").removeClass("home"),$(this).closest("tr").find(".away").addClass("home").removeClass("away"),$(this).closest("tr").find(".next-away").addClass("away").removeClass("next-away"),oSpreadFavor=$(this).closest("tr").find(".spread-favor"),$(oSpreadFavor).val("away"==$(oSpreadFavor).val()?"home":"away"),makeActive()}),$(".swap-spread").on("click",function(){oFavorite=$(this).closest("tr").find("[name='favorite']"),oUnderdog=$(this).closest("tr").find("[name='underdog']"),sFavoriteTeam=$(oFavorite).val(),nFavoriteTeam=$(oFavorite).data("id"),oFavorite.val(oUnderdog.val()).data("id",oUnderdog.data("id")),oUnderdog.val(sFavoriteTeam).data("id",nFavoriteTeam),makeActive()}),$(".container").on("keyup",".spread,.tiebreak",function(){makeActive(),$(".container").off("keyup",".spread,.tiebreak")}),$(".container").on("focus",".date,.time",function(){makeActive()}),$(".container").on("click",".move",function(){makeActive(),$(".container").off("click",".move")}),$(".container").on("click",".save-games:not(.disabled)",function(e){e.stopPropagation();var a=!0,t="",s="",i=[];arGames=[],$("#activeGames .game").each(function(){return""==$(this).find(".spread-favor").val()?(alert("Please set a spread favor for this game"),$(this).find(".spread-favor").focus(),a=!1,!1):""==$(this).find(".tiebreak").val()?(alert("Please set a tiebreak for this game"),$(this).find(".tiebreak").focus(),a=!1,!1):(i.push($(this).find(".tiebreak").val()),t=$(this).find(".game-date").val().trim()+" "+fixTime($(this).find(".game-time").val().trim()),s=$(this).find(".lock-date").val().trim()+" "+fixTime($(this).find(".lock-time").val().trim()),19==t.length&&$.get("/?action=game.isDateValid&dtToCheck="+t,function(e){e.length>0?t=e:(alert("Please check your game date and time. Doesn't appear to be valid"),$(this).focus(),a=!1)},"json"),19==s.length&&$.get("/?action=game.isDateValid&dtToCheck="+s,function(e){e.length>0?s=e:(alert("Please check your game lock date and time. Doesn't appear to be valid"),$(this).focus(),a=!1)},"json"),stGame={nGameID:$(this).closest("tr").data("game-id"),sHomeTeam:$(this).find(".home").val(),nHomeTeamID:$(this).find(".home").data("id"),sHomeTeamURL:$(this).find(".home").data("url"),sAwayTeam:$(this).find(".away").val(),nAwayTeamID:$(this).find(".away").data("id"),sAwayTeamURL:$(this).find(".away").data("url"),nSpread:toDecimal($(this).find(".spread").val()),sSpreadFavor:$(this).find(".spread-favor").val(),sGameDateTime:t.length>0?t:"",dtLock:s.length>0&&$("#showLock").is(":checked")?s:"",nTiebreak:$(this).find(".tiebreak").val()},void arGames.push(stGame))}),a&&i.reduce(function(e,a){return e*a})!=fact(arGames.length)&&(alert("It looks like you may have tiebreakers wrong. More than likely you have used the same tiebreak number twice. Please double check"),a=!1),a&&($("#arGames").val($.toJSON(arGames)),$(".save-games").text("Saving games ...").prop("disabled",!0),$("#weekGames").submit())}),$("#showLock").on("click",function(){$(this).is(":checked")?$(".lock-control").removeClass("hide"):$(".lock-control").addClass("hide")})});
//# sourceMappingURL=maps/week.min.js.map